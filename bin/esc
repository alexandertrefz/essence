#!/usr/bin/env node

let process = require("process")
let fs = require("fs")
let path = require("path")

let argv = require("minimist")(process.argv.slice(2), {
	default: {
		pretty: false,
	},
})

let Parser = require("../lib/parser")

let sourceFileName = argv._[0]
let sourceFileNameParsed = path.parse(sourceFileName)
let targetFileName = sourceFileNameParsed.dir + "/" + sourceFileNameParsed.name + ".js"

fs.readFile(sourceFileName, "utf8", (err, data) => {
	let module = Parser.parse(data)
	let js

	if (argv.pretty) {
		js = JSON.stringify(module, null, "\t")
	} else {
		js = JSON.stringify(module)
	}

	fs.writeFileSync(targetFileName, js)
})
